<h1>Bem-vindo ao Dashboard do Fornecedor</h1>

<ul>
  <li>
    <%= button_to "Sair", destroy_usuario_session_path, method: :delete, data: { confirm: "Tem certeza que deseja sair?" } %>
  </li>
</ul>

<h2>Pedidos de Compra Recebidos</h2>
<% if @pedidos.present? %>
  <table class="table-auto w-full border-collapse">
    <thead>
      <tr class="bg-gray-100 border-b">
        <th class="px-2 py-2">Pedido</th>
        <th class="px-2 py-2">Cliente</th>
        <th class="px-2 py-2">Valor Total</th>
        <th class="px-2 py-2">Data de Validade</th>
        <th class="px-2 py-2">Ações</th>
      </tr>
    </thead>
    <tbody>
      <% @pedidos.each do |pedido| %>
        <tr class="border-b">
          <td class="px-2 py-2"><%= "Pedido ##{pedido.id}" %></td>
          <td class="px-2 py-2"><%= pedido.cliente.nome %></td>
          <td class="px-2 py-2"><%= number_to_currency(pedido.valor_total) %></td>
          <td class="px-2 py-2"><%= pedido.data_validade.strftime("%d/%m/%Y") if pedido.data_validade %></td>
          <td class="px-2 py-2">
            <%= link_to "Visualizar PDF", pdf_pedidos_de_compra_path(pedido), target: "_blank", class: "text-blue-600" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>Não há pedidos de compra.</p>
<% end %>

<h2>Cotações Disponíveis</h2>
<% if @respostas.any? %>
  <table class="table-auto w-full border-collapse">
    <thead>
      <tr class="bg-gray-100 border-b">
        <th class="px-2 py-2">Cotação</th>
        <th class="px-2 py-2">Data de Validade da Cotação</th>
        <th class="px-2 py-2">Status</th>
        <th class="px-2 py-2">Ações</th>
      </tr>
    </thead>
    <tbody>
      <% @respostas.each do |resposta| %>
        <tr class="border-b">
          <td class="px-2 py-2">
            <%= "Cotação ##{resposta.cotacao.id}" %>
          </td>
          <td class="px-2 py-2">
            <% if resposta.cotacao.data_validade.present? %>
              <%= resposta.cotacao.data_validade.strftime("%d/%m/%Y") %>
            <% end %>
          </td>
          <td class="px-2 py-2"><%= resposta.status.capitalize %></td>
            <td class="px-2 py-2">
              <% if resposta.status == "aguardando assinatura" %>
                <%= link_to "Responder", edit_fornecedores_resposta_de_cotacao_path(resposta), class: "text-blue-600" %>
                <%= link_to "Upload do Documento Assinado", upload_documento_fornecedores_resposta_de_cotacao_path(resposta), class: "ml-4 text-green-600" %>
                <%= link_to "Visualizar para Impressão", pdf_fornecedores_resposta_de_cotacao_path(resposta), target: "_blank", class: "ml-4 text-purple-600" %>
              <% elsif resposta.status == "finalizado" %>
                <%= link_to "Baixar Cotação Enviada", rails_blob_path(resposta.documento_assinado, disposition: "attachment"), class: "text-blue-600" %>
                <%= link_to "Visualizar Cotação", rails_blob_path(resposta.documento_assinado, disposition: "inline"), target: "_blank", class: "ml-4 text-green-600" %>
              <% else %>
                <%= link_to "Responder", edit_fornecedores_resposta_de_cotacao_path(resposta), class: "text-blue-600" %>
              <% end %>
            </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>Não há respostas de cotação disponíveis.</p>
<% end %>
